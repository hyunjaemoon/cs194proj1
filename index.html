<!doctype html>

<html>

<head>
  <meta charset="utf-8">
  <title>Hyun Jae Moon's CS194-26 Project 1</title>
  <link href="styles/style.css" rel="stylesheet" type="text/css">
  <style>
    html {
      background-color: #e0ffff;
    }

    h1 {
      text-align: center;
      font-family: 'Georgia';
      font-size: 40px;
    }

    h2 {
      text-align: center;
      font-family: 'Copperplate';
      font-size: 30px;
    }

    p {
      text-align: left;
      font-family: 'Times New Roman';
      font-size: 20px;
      line-height: 2;
    }

    div {
      text-align: center;
    }

    body {
      width: 1000px;
      margin: 0 auto;
      padding: 0 20px 20px 20px;
    }

    .column {
      float: left;
      width: 32%;
      padding: 5px;
    }

    /* Clearfix (clear floats) */
    .row::after {
      content: "";
      clear: both;
      display: table;
    }

    table,
    th,
    td {
      border: 1px solid black;
    }
  </style>
</head>

<body>
  <h1>Images of the Russian Empire: Colorizing the Prokudin-Gorskii photo collection</h1>
  <h3 style="text-align: right"> By Hyun Jae Moon </h3>

  <h2> Introduction </h2>

  <p>
    The goal of this project is to extract the three color channel images (R, G, B),
    place them on top of each other with an appropriate alignment using both
    exhaustive and pyramid implementation.
  </p>

  <h2> Normalized Cross Correlation (NCC) </h2>
  <p style="text-align:center;"><img src="NCCformula.png" alt="NCC" style="width:50%"></p>
  <p>
    The Nomrmalized Cross Correlation is widely used for checking image similarity, and
    it checks whether two datas contain a similar pattern of values. To implement the
    formula above in terms of Python, we would first obtain the mean and standard deviation
    of the two images we are about to align using np.mean and np.std. Since we can
    extract the part regarding <br> sqrt(1.0 / (n-1)) from both coefficients, so that we can
    multiply, np.sum, and then multiply the result by 1.0/(n-1).
  </p>
  <p style="font-size: 15px;">
    Citation:
    <a href="https://xcdskd.readthedocs.io/en/latest/cross_correlation/cross_correlation_coefficient.html">
      https://xcdskd.readthedocs.io/en/latest/cross_correlation/cross_correlation_coefficient.html
    </a>
  </p>

  <h2> Exhaustive Method </h2>
  <p>
    For jpg files, which are lot smaller in file size, I've implemented an
    exhaustive algorithm to detect pixel offsets and align the three color channels
    appropriately. Firstly, I would crop the image by a fixed value of 20px to cut the
    black borders off. Then, the exhuastive algorithm would check in the range of
    [-15, 15] pixels, and search for the largest Nomralized Cross Correlation.
    I would first align green channel to blue channel and find
    the appropriate pixel offset of the green channel. Then, I would do the same for
    red channel to blue channel. Finally, I would stack all three channels into
    one colored image. Here are the results for the jpg files after alignment
    with their respective offsets.
  </p>

  <div class="row">
    <div class="column">
      <img src="out/cathedral.jpg" alt="Cathedral" style="width:100%">
      <p style="text-align: center">cathedral.jpg | G: (2, 5), R: (3, 12)</p>
    </div>
    <div class="column">
      <img src="out/monastery.jpg" alt="Monastery" style="width:100%">
      <p style="text-align: center">monastery.jpg | G: (2, -3), R: (2, 3)</p>
    </div>
    <div class="column">
      <img src="out/tobolsk.jpg" alt="tobolsk" style="width:100%">
      <p style="text-align: center">tobolsk.jpg | G: (3, 3), R: (3, 6)</p>
    </div>
  </div>

  <h2> Pyramid Method </h2>
  <p>
    The downside of the exhaustive method is that it takes too much time to process
    large image files such as tiff files. To fasten the process, we must rescale the
    image to a smaller pixel margins, such that alignment can be processed at a
    much faster rate. Firstly, I've cropped the image with a fixed value of 200px
    to remove the black borders. Then I've continuously rescaled the image by half per step
    and proceed 5 times, which would result in 1/32 of the original image size. Then,
    we would perform the exhaustive method on a smaller image, and come back to the greater
    version to check for the range of [offset * 2 &#177; 1]. Then, it will produce the correct offset.
  </p>
  <p style="text-align:center;">
    Given Examples
  </p>
  <div class="row">
    <div class="column">
      <img src="out/church.jpg" alt="Church" style="width:100%">
      <p style="text-align: center; font-size: 15px;">church.tif | G: (4, 25), R: (-4, 58)</p>
    </div>
    <div class="column">
      <img src="out/emir.jpg" alt="Emir" style="width:100%">
      <p style="text-align: center; font-size: 15px;">emir.tif | G: (24, 49), R: (-511, 126)</p>
    </div>
    <div class="column">
      <img src="out/harvesters.jpg" alt="Harvesters" style="width:100%">
      <p style="text-align: center; font-size: 15px;">harvesters.tif | G: (16, 59), R: (13, 124)</p>
    </div>
  </div>
  <div class="row">
    <div class="column">
      <img src="out/icon.jpg" alt="Icon" style="width:100%">
      <p style="text-align: center; font-size: 15px;">icon.tif | G: (17, 40), R: (23, 89)</p>
    </div>
    <div class="column">
      <img src="out/lady.jpg" alt="Lady" style="width:100%">
      <p style="text-align: center; font-size: 15px;">lady.tif | G: (8, 47), R: (11, 113)</p>
    </div>
    <div class="column">
      <img src="out/melons.jpg" alt="Melons" style="width:100%">
      <p style="text-align: center; font-size: 15px;">melons.tif | G: (9, 82), R: (12, 178)</p>
    </div>
  </div>
  <div class="row">
    <div class="column">
      <img src="out/onion_church.jpg" alt="Onion Church" style="width:100%">
      <p style="text-align: center; font-size: 15px;">onion_church.tif | G: (26, 51), R: (36, 108)</p>
    </div>
    <div class="column">
      <img src="out/self_portrait.jpg" alt="Self Portrait" style="width:100%">
      <p style="text-align: center; font-size: 15px;">self_portrait.tif | G: (28, 78), R: (36, 176)</p>
    </div>
    <div class="column">
      <img src="out/three_generations.jpg" alt="Three Generations" style="width:100%">
      <p style="text-align: center; font-size: 15px;">three_generations.tif | G: (14, 53), R: (10, 111)</p>
    </div>
  </div>
  <div class="row">
    <div class="column">
      <img src="out/train.jpg" alt="Train" style="width:100%">
      <p style="text-align: center; font-size: 15px;">train.tif | G: (5, 42), R: (31, 87)</p>
    </div>
    <div class="column">
      <img src="out/workshop.jpg" alt="Workshop" style="width:100%">
      <p style="text-align: center; font-size: 15px;">workshop.tif | G: (0, 52), R: (-12, 104)</p>
    </div>
  </div>
  <p style="text-align:center;">
    Chosen Examples
  </p>
  <div class="row">
    <div class="column">
      <img src="out/kurmy.jpg" alt="Kurmy" style="width:100%">
      <p style="text-align: center; font-size: 15px;">kurmy.tif | G: (-18, 25), R: (-38, 115)</p>
    </div>
    <div class="column">
      <img src="out/lugano.jpg" alt="Lugano" style="width:100%">
      <p style="text-align: center; font-size: 15px;">lugano.tif | G: (7, 55), R: (32, 120)</p>
    </div>
    <div class="column">
      <img src="out/zakat.jpg" alt="Zakat" style="width:100%">
      <p style="text-align: center; font-size: 15px;">zakat.tif | G: (-41, 75), R: (-68, 114)</p>
    </div>
  </div>

  <h2> Alignment Time Spent on Each Image </h2>
  <p>
    cathedral.jpg took 1.53 seconds<br>
    monastery.jpg took 1.61 seconds<br>
    tobolsk.jpg took 1.55 seconds<br>
    church.tif took 5.98 seconds<br>
    emir.tif took 5.66 seconds<br>
    harvesters.tif took 5.89 seconds<br>
    icon.tif took 6.06 seconds<br>
    lady.tif took 5.75 seconds<br>
    melons.tif took 6.06 seconds<br>
    onion_church.tif took 5.95 seconds<br>
    self_portrait.tif took 5.9 seconds<br>
    three_generations.tif took 6.15 seconds<br>
    train.tif took 6.1 seconds<br>
    workshop.tif took 6.13 seconds<br>
    kurmy.tif took 6.21 seconds<br>
    lugano.tif took 6.48 seconds<br>
    zakat.tif took 6.11 seconds<br><br>
    On average, the exhaustive method on jpg files took 1.56 seconds.<br>
    On average, the pyramid method on tif files took 6.03 seconds.
  </p>

  <h2> What is wrong with 'emir.tif'? </h2>
  <h3 style="text-align:center;"> (Bells & Whistles: Edge Detection) </h3>
  <p>
    You probably realized that all my other photos look good except 'emir.tif'. Why is that?
    The reason why is because each color channels of the image don't necessarily
    have the same brightness value. In such case, we will use edge detection to
    consider such situations, and produce a better version. Here is the image produced
    before adding edge detection.
  </p>
  <p style="text-align:center;"><img src="out/emir.jpg" alt="Emir" style="width:50%"></p>
  <p>
    As you can see, the red channel of the image is far off to the left. However, with edge
    detection, this is not going to be an issue at all. Here, I will be utilizing
    Canny Edge Detector under skimage. It uses a filter based on the derivative
    of a Gaussian in order to compute the intensity of the gradients. Since skimage.feature.canny
    produces boolean values, we should multiply the values by 255 to convert into a grey scale.
    Then, we perform the pyramid implementation to align the image. The edge detection
    takes some time (around 5 more seconds), but it works like magic.
  </p>
  <div class="row">
    <div class="column">
      <img src="extra/rededge.jpg" alt="Rededge" style="width:100%">
      <p style="text-align: center">Red Edge of 'emir.tif'</p>
    </div>
    <div class="column">
      <img src="extra/greenedge.jpg" alt="Greenedge" style="width:100%">
      <p style="text-align: center">Green Edge of 'emir.tif'</p>
    </div>
    <div class="column">
      <img src="extra/blueedge.jpg" alt="Blueedge" style="width:100%">
      <p style="text-align: center">Blue Edge of 'emir.tif'</p>
    </div>
  </div>
  <p style="text-align:center;"><img src="extra/emir.jpg" alt="EmirFixed" style="width:50%"></p>
  <p style="text-align:center;">Combined Results of all three edge channels!</p>
</body>

</html>
